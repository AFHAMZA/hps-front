<app-navbar />
<section class="bg-primary position-relative">
  <div class="container">
    <div class="row">
      <div class="col-lg-12 col-md-12">
        <h2 class="ipt-title text-light">WhatsApp Integration</h2>
        <span class="ipn-subtitle">Manage your WhatsApp sessions</span>
      </div>
    </div>
  </div>
  <div class="ht-30"></div>
</section>

<section class="gray-simple">
  <div class="container">
    <div class="row justify-content-center">
      <div class="col-lg-10 col-md-12">
        <div class="card rounded-3 shadow p-4">
          <!-- Success Message -->
          <div *ngIf="successMessage" class="alert alert-success text-center">
            {{ successMessage }}
          </div>
          <!-- Error Message -->
          <div *ngIf="errorMessage" class="alert alert-danger text-center">
            {{ errorMessage }}
          </div>
          <!-- Session Status -->
          <div class="mb-4">
            <h4>
              WhatsApp Session Status:
              <span
                [ngClass]="{
                  'text-success': sessionStatus === 'connected',
                  'text-warning': sessionStatus === 'starting',
                  'text-danger': !sessionStatus
                }"
              >
                {{
                  sessionStatus
                    ? sessionStatus.charAt(0).toUpperCase() +
                      sessionStatus.slice(1)
                    : "Not started"
                }}
              </span>
            </h4>
            <!-- QR Code Display -->
            <div
              *ngIf="qrCode && sessionStatus !== 'connected'"
              class="qr-code-container text-center"
            >
              <p>Scan the QR code to start your WhatsApp session:</p>
              <app-qr-code [value]="qrCode" class="qr-code"></app-qr-code>
            </div>
            <!-- Session Active Indicator -->
            <div *ngIf="sessionStatus === 'connected'" class="text-center">
              <span class="badge bg-success fs-5">
                <i class="bi bi-check-circle-fill me-2"></i>Session Active
              </span>
            </div>
          </div>
          <!-- Action Buttons -->
          <div class="d-flex gap-3 flex-wrap justify-content-center">
            <div *ngIf="loading" class="text-center w-100">
              <div class="spinner-border text-primary" role="status">
                <span class="visually-hidden">Loading...</span>
              </div>
            </div>
            <button
              class="btn btn-primary"
              (click)="startWhatsApp()"
              [disabled]="sessionStatus === 'connected' || loading"
            >
              Start WhatsApp
            </button>
            <button
              class="btn btn-warning"
              (click)="restartWhatsApp()"
              [disabled]="!sessionStatus || loading"
            >
              Restart Session
            </button>
            <button
              class="btn btn-danger"
              (click)="deleteWhatsApp()"
              [disabled]="!sessionStatus || loading"
            >
              Delete Session
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>
</section>

<app-footer-top [bg]="'theme-bg'" />
<app-footer />
